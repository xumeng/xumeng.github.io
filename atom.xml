<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>逐鹿 IT</title>
  
  <subtitle>君子猛猛如玉</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://amonxu.com/"/>
  <updated>2019-03-16T05:32:20.676Z</updated>
  <id>http://amonxu.com/</id>
  
  <author>
    <name>逐鹿 IT</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>jstat官方文档, jstat命令详解</title>
    <link href="http://amonxu.com/2019/03/07/2019-03-07-jstat-documentation/"/>
    <id>http://amonxu.com/2019/03/07/2019-03-07-jstat-documentation/</id>
    <published>2019-03-07T06:02:33.000Z</published>
    <updated>2019-03-16T05:32:20.676Z</updated>
    
    <content type="html"><![CDATA[<p>jstat 用于监视 Java 虚拟机(JVM)的统计数据。这个命令是实验性的，不受支持。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>jstat &lt;一般选项 | 输出选项&gt; &lt;vmid&gt; &lt;时间间隔&gt; &lt;count&gt;</code></p><p><code>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]</code></p><p><strong><em>一般选项</em></strong></p><p>​    一个通用命令行选项，<code>-help</code> 或者 <code>-options</code>。详见 <a href="">一般选项</a></p><p><strong><em>输出选项</em></strong></p><p>​    包含单个 <code>statOption</code>的一个或多个输出选项，以及 -t，-h 和 -J 选项。详见<a href="">输出选项</a></p><p><strong><em>vmid</em></strong></p><p>​    虚拟机标识符，是指示目标 JVM 的一个字符串。一般格式如下：</p><p>​    <code>[protocol:][//]lvmid[@hostname[:port]/servername]</code></p><p>​    <code>vmid</code> 的语法对应 URI 的语法。<code>vmid</code> 字符串可以是从表示本地 JVM 的一个整数，到指定通信协议、端口和其他特定实现值的更复杂的结构。详见<a href="">虚拟机标识符</a></p><p><strong><em>间隔时间</em></strong></p><p>​    以指定单位秒(s)或毫秒(ms)的采样间隔。默认是秒，必须为正整数。当指定时，<code>jstat</code> 命令会在每个间隔时间进行输出。</p><p><strong><em>数量</em></strong></p><p>​    要显示的样本数。默认无穷大，这样 <code>jstat</code> 命令会一直输出的统计信息，直到 JVM 终止或者 <code>jstat</code> 命令终止。必须为正整数。</p><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p><code>jstat</code> 命令显示被监测的 Java HotSpot VM的性能统计数据。用虚拟机标识符或者<code>vmid</code>选项标识目标 JVM。</p><h2 id="虚拟机标识"><a href="#虚拟机标识" class="headerlink" title="虚拟机标识"></a>虚拟机标识</h2><p>vmid 的语法对应于 URI 的语法：</p><p><code>[protocol:][//]lvmid[@hostname[:port]/servername]</code> </p><p><strong><em>protocol</em></strong></p><p>​    通信协议，如果省略协议且没有指定主机名，默认协议是特定于平台的优化本地协议。如果省略了协议并指定主机名，那么默认协议是 <code>RMI</code>。</p><p><strong><em>lvmid</em></strong></p><p>​    目标 JVM 的本地虚拟机标识。<code>lvmid</code> 是一个特定于平台的值，它唯一地标识系统上的 JVM。<code>lvmid</code> 是虚拟机标识符唯一需要的组件。lvmid 通常是(但不一定是)目标 JVM 进程的操作系统的标识符。你可以使用 <code>jps</code> 命令来确定 <code>lvmid</code>，此外也可以在 Solaris、Linux、OS X平台上使用 <code>ps</code>命令来确定 <code>lvmid</code>，在 Windows上可以使用 Windows 任务管理器来操作。</p><p><strong><em>hostname</em></strong></p><p>​    目标主机的主机名或 IP 地址。如果省略了 <code>hostname</code>，默认是本地主机。</p><p><strong><em>port</em></strong></p><p>​    与远程服务器通信的端口。如果省略主机名或协议指指定优化的本地协议，则忽略端口值。否则，端口参数的处理是特定于实现的。对于默认的 <code>rmi</code> 协议，端口值指示远程主机上 rmiregistry 的端口号。如果省略端口值且协议值指示 <code>rmi</code>，则使用默认 rmiregistry 的端口。</p><p><code>servername</code></p><p>​    servername 参数的矗立取决于实现。对于优化的本地协议，这个字段被忽略。对于 <code>rmi</code> 协议，它表示远程主机上 RMI 远程对象的名称。</p><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><p>jstat 命令支持两种选项类型：一般选项和输出选项。一般选项用来显示简单的用法和版本信息。输出选项决定统计输出的内容和格式。</p><p>所有选项及其功能都可能在未来的版本中更改或移除。</p><h4 id="一般选项"><a href="#一般选项" class="headerlink" title="一般选项"></a>一般选项</h4><p>如果你指定了一个一般选项，则不能再指定任何其他选项或参数。</p><p><strong><em>-help</em></strong></p><p>​    显示帮助信息    </p><p><strong><em>-options</em></strong></p><p>​    显示一个统计选项列表，详见<a href="">输出选项</a></p><p>​    </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;jstat 用于监视 Java 虚拟机(JVM)的统计数据。这个命令是实验性的，不受支持。&lt;/p&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;&lt;code&gt;jstat &amp;lt;一
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="Java" scheme="http://amonxu.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>再见了，广州</title>
    <link href="http://amonxu.com/2019/03/05/2019-03-05-Damn-it-guangzhou/"/>
    <id>http://amonxu.com/2019/03/05/2019-03-05-Damn-it-guangzhou/</id>
    <published>2019-03-05T14:02:33.000Z</published>
    <updated>2019-03-14T14:20:42.172Z</updated>
    
    <content type="html"><![CDATA[<p>三月份的深圳，春寒料峭。</p><p>天气阴阴晴晴，反反复复，犹犹豫豫的徘徊在春天和冬天之间。此时，各行各业普遍不景气，到处弥漫着互联网寒冬和裁员的凋零气息。但没什么比二哥心更冷的了。</p><p>四年前的广州，热火朝天。</p><!-- 二哥从 ZZ 出来，彼时，以社交和 O2O 为首的移动互联网乱战纷飞的局面逐渐消停，微信、支付宝、今日头条等移动互联网巨头已经浮出水面。AI 人工智能，则如同一轮红日，冉冉升起。二哥一头扎入 AI 的大潮中，在一个创业公司做开发。二哥的猛子扎的之深，以至于未来几年都不能上岸。创业嘛，理想嘛，总是要有点牺牲的，二哥抛弃了呆了几年的广州和优渥的待遇，孤身来到深圳，和降薪的条件。都说创业公司拥抱变化，二哥怎么也没想到变化来的太快了点，别怕，公司还在，只是技术团队几乎全部出走。原来后台留下的一堆坑，一时半会也找不到合适的人来填，二哥赶鸭子上架般的顶了上去。谁曾想这一顶，就是四年。四年后，热血青年的二哥感觉垂垂老矣；四年后，秀发茂密的二哥感觉额头发凉；四年后，一人吃饱全家不饿的二哥已经买了车房结婚。二哥感觉自己需要走了，再不走就老了。尽管在公司已经是老人了，但也差不多快成那个老人了。二哥想过随着公司的发展壮大，随着业务的扩张开拓，总有一天自己是有机会回去广州的。或者，很体面地回去。没想到这一天来的也太快了点，只不过，是用了另一种方式。老大离开公司以后，二哥变成了研发这边的老大。 -->]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;三月份的深圳，春寒料峭。&lt;/p&gt;
&lt;p&gt;天气阴阴晴晴，反反复复，犹犹豫豫的徘徊在春天和冬天之间。此时，各行各业普遍不景气，到处弥漫着互联网寒冬和裁员的凋零气息。但没什么比二哥心更冷的了。&lt;/p&gt;
&lt;p&gt;四年前的广州，热火朝天。&lt;/p&gt;
&lt;!-- 二哥从 ZZ 出来，彼时，以
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="随笔" scheme="http://amonxu.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>再见二月</title>
    <link href="http://amonxu.com/2019/02/28/2019-02-28-Bye-Bye-Feb/"/>
    <id>http://amonxu.com/2019/02/28/2019-02-28-Bye-Bye-Feb/</id>
    <published>2019-02-28T12:46:01.000Z</published>
    <updated>2019-03-02T13:33:32.616Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.unsplash.com/photo-1546260286-b27099f920cc?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;w=1000&amp;q=80" alt="new year, new adventures 2019"></p><p>2019 年二月过去了。</p><p>二月是静悄悄的，这一个月中，它大多时候是被农历代替的，我们用腊月二十七代表2月1号，大年三十代替2月4号，元宵节代替2月19号，也就2月14号这一天，它不被称作正月初十，而是叫情人节。</p><p>二月是容易被遗忘的，在此之前的一月，人们混淆于到底是 2019 年还是 2018 年，是该迎接这新年，还是该珍惜这旧年。就这样到了2月，人们发现对新年并没有了什么期待，反倒和从前的那些年月并无什么两样。</p><p>二月是短暂的，它开始于春节长假伊始，长假结束时它已然进入半晌，等到调整完工作节奏，二月已入尾声。加上天生地比其他月份少去十分之一，没等你痛惜二月地匆匆而逝时，它就结束使命了。</p><p>二月是忙碌的，见一年见不到的人，吃一年吃不到的饭，喝一年喝不到的酒。从折腾着挤上回家的车，到再折腾着挤上回来的车，没有一时的歇息。</p><p>饱含对生活的热爱吧！饱含对未来的渴望吧！唯有把握现在，才能拥有未来，才能缅怀过去。</p><p>2019, Make different!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://images.unsplash.com/photo-1546260286-b27099f920cc?ixlib=rb-1.2.1&amp;amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;amp;w=1000&amp;amp;q=80&quot; alt
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="Note" scheme="http://amonxu.com/tags/Note/"/>
    
  </entry>
  
  <entry>
    <title>旧时旧梦</title>
    <link href="http://amonxu.com/2019/02/22/2019-2-22-Past-Dream/"/>
    <id>http://amonxu.com/2019/02/22/2019-2-22-Past-Dream/</id>
    <published>2019-02-22T14:59:33.000Z</published>
    <updated>2019-03-02T13:10:21.244Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://p3.pstatp.com/large/dfic-imagehandler/a8c47ee7-163a-41b3-8826-a90c9cb4d6f5" alt="pic"></p><h3 id="旧梦"><a href="#旧梦" class="headerlink" title="旧梦"></a>旧梦</h3><p>雨后，空气中满是清冷，到时都是湿漉漉的，走在一条泥泞的小路上。沾水的草地，暗黄的天空，钻入衣服的空气。</p><p>初中同学 45 度俯视着我，我讨厌别人这样压迫着看我，也讨厌他那婆婆妈妈般的性格，哪怕是十一年没见了。</p><p>逃离和他的相遇后，我穿过蜿蜒的小路，来到一个荒废的操场，半人高的野草，绿的发亮。破旧不堪的校门半掩在草丛里，被日晒雨淋显得灰白的油漆已经脱落了一大半，露出丑陋的铁锈色，一把生满红褐色铁锈的大锁肆无忌惮的挂在门上，嘲笑着我这个陌生的访客。顶部几根枪头直插云天，愤怒的指向阴暗的天际。</p><p>这番落败的景象实在让我觉得无味，我只好继续前行，忽然进入一个房子里。像是被犁翻耕过的土地，像是爆炸后产生的废墟，地上密密麻麻铺满了室内原来物品的碎片，均匀到像是秋天树林里铺满落叶的地面。</p><p>我拾起一个碎片，一张照片，是关于我的。我倏然悲从中来，这张照片上面是十几年前的我，而今所有记忆皆毁于一旦、尽为碎片。转身看屋内，都是我的记忆，小学初中、高中大学、暑假、寒假、过年…一张张，一片片，拼接成我的前二十几年。</p><p>我应该是觉得我老了，我应该是觉得我应该痛哭流涕，脑中环绕着：世间最大的痛苦是发现一切都旧了。发现旧时的自己，发现旧时的事物，全化为灰烬，剩下一个旧的自己，残留在世上。</p><p>想至此，我甚为怀念那个小男孩，他贪玩又聪明，他调皮的事迹和他优秀的成绩一样在方圆几里的村子里人尽皆知。他身体结实、力气惊人，健康又快乐地成长着，除了…略微缺乏的父爱。<br><img src="http://p1.pstatp.com/large/dfic-imagehandler/eafc830f-3a93-460b-b44f-b1b9776cfbc6" alt="head"></p><p>假如他看到眼前这个旧的，废物一般的自己，他一定很不屑。  </p><blockquote><p>你这么矮这么瘦这么小吗？<br>你的名牌大学呢？<br>你不是会有钱到了不起吗？<br>你不是说不会忘记你的兄弟朋友吗？<br>切，瞧你这熊样，我能轻易打倒你。</p></blockquote><p>眼前突然一黑一亮，嚯！我醒了。顿时我悲从心来，打开窗帘，夜色放浅，天空渐明。才知我做了一个旧梦，梦里一切都变旧了。我想和谁说，我做了一个旧梦，梦里一切都变旧了。但想无人与说，且当聊作孤梦。</p><hr><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><blockquote><p>原文作于2016年11月6日清晨，2年后的今天被发现于备忘录。<br>重读的感觉，<br>先是思乡，思念那种雨后乡下的感觉。<br>接着是恐怖，恐怖的是有人看着我，且我忘记了他是谁。<br>然后是压抑，至今还能感受到梦中那种压抑。<br>后面就是怀念，怀念那亦真亦假的过去和记忆。<br>最后是悲哀，痛苦，直到长叹一声：唉！</p></blockquote><p>有关照片碎一地的记忆我一直在记忆中仿佛昨天，直到后面听到<strong>许飞</strong>的《<strong>父亲写的散文诗</strong>》，方知此种感觉正是 「<strong>回忆</strong>」 二字。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;http://p3.pstatp.com/large/dfic-imagehandler/a8c47ee7-163a-41b3-8826-a90c9cb4d6f5&quot; alt=&quot;pic&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;旧梦&quot;&gt;&lt;a href=&quot;#旧梦&quot; cla
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="拾忆集" scheme="http://amonxu.com/tags/%E6%8B%BE%E5%BF%86%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>《亿级流量网站架构核心技术》读书笔记</title>
    <link href="http://amonxu.com/2019/02/20/2019-02-20-Reading-Note/"/>
    <id>http://amonxu.com/2019/02/20/2019-02-20-Reading-Note/</id>
    <published>2019-02-20T12:45:33.000Z</published>
    <updated>2019-03-02T13:14:34.872Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g0orej4jg5j30m80m8my3.jpg" alt="cover"></p><h1 id="第一部分-概述"><a href="#第一部分-概述" class="headerlink" title="第一部分 概述"></a>第一部分 概述</h1><h3 id="1-交易型系统设计的一些原则"><a href="#1-交易型系统设计的一些原则" class="headerlink" title="1. 交易型系统设计的一些原则"></a>1. 交易型系统设计的一些原则</h3><h5 id="1-1-高并发原则"><a href="#1-1-高并发原则" class="headerlink" title="1.1 高并发原则"></a>1.1 高并发原则</h5><ul><li>无状态</li><li>拆分（系统维度、功能维度、读写维度、AOP 维度、模块维度）</li><li>服务化（进程内服务 - 单机远程服务 - 集群手动注册服务 - 自动注册和发现服务 - 服务的分组/隔离/路由 - 服务治理如限流/黑白名单）</li><li>消息队列</li><li>数据异构（数据异构、数据闭环）</li><li>缓存银弹（浏览器缓存、App 客户端缓存、CDN 缓存、接入层缓存、应用层缓存、分布式缓存）</li><li>并发化</li></ul><h5 id="2-高可用原则"><a href="#2-高可用原则" class="headerlink" title="2. 高可用原则"></a>2. 高可用原则</h5><ul><li>降级</li><li>限流</li><li>切流量</li><li>可回滚</li></ul><h5 id="3-业务设计原则"><a href="#3-业务设计原则" class="headerlink" title="3. 业务设计原则"></a>3. 业务设计原则</h5><ul><li>防重设计(防重 Key、防重表)</li><li>幂等设计（消息中间件）</li><li>流程可定义</li><li>状态与状态机</li><li>后台操作系统可反馈</li><li>后台系统审批化（操作日志记录，保证操作可追溯、可审计）</li><li>文档和注释</li><li>备份</li></ul><h1 id="第二部分-高可用"><a href="#第二部分-高可用" class="headerlink" title="第二部分 高可用"></a>第二部分 高可用</h1><h3 id="2-负载均衡与反向代理"><a href="#2-负载均衡与反向代理" class="headerlink" title="2. 负载均衡与反向代理"></a>2. 负载均衡与反向代理</h3><p>对于一般应用来说，有 Nginx 就可以了，但 Nginx 一般用于七层负载均衡，吞吐量有一定限制，为了提升整体吞吐量，会在 DNS 和 Nginx 之间引入接入层，如使用 LVS(软件负载均衡器)、F5(硬负载均衡器)可以做四层负载均衡，即首先 DNS 解析到 LVS/F5，然后 LVS/F5转发给 Nginx，再由 Nginx 转发给后端 Server。</p><p><strong>负载均衡主要关注几个方面：</strong></p><ul><li>上游服务器配置：使用 upstream server 配置上游服务器</li><li>负载均衡算法：配置多个上游服务器时的负载均衡机制</li><li>失败重试机制</li><li>服务器心跳检查</li></ul><p><strong>负载均衡算法 :</strong></p><ul><li>round-robin：轮询算法，默认 LB 算法，配合 weight 配置可以实现基于权重的轮询</li><li>ip_hash：根据 IP 进行 LB，相同的 IP 将 LB 到同一个upstream server</li><li>hash key：对某一个 key 进行 hash或者使用一致性 hash 算法进行 LB</li><li>least_conn：将请求 LB 到最少活跃连接的 upstream server</li><li>least_time：Nginx 商业版功能，基于最小平均响应时间进行 LB</li></ul><p><strong>健康检查：</strong></p><ul><li>TCP 心跳检查</li><li>HTTP心跳检查</li></ul><h3 id="3-隔离术"><a href="#3-隔离术" class="headerlink" title="3. 隔离术"></a>3. 隔离术</h3><p>隔离是指将系统或资源分割开，系统隔离是为了在系统发生故障时，能限定传播范围和影响范围，即发生故障后不会出现滚雪球效应，从而保证只有出问题的服务不可用，其他服务还是可用的。资源隔离通过隔离来减少资源竞争，保障服务间的相互不影响和可用性。出现系统问题时，可以考虑 LB 路由、自动/手动切换分组或者降级等手段来保障可用性。</p><ul><li>线程隔离（不同的线程池）</li><li>进程隔离（单实例到多子系统）</li><li>集群隔离（不同的集群）</li><li>机房隔离（不同的机房）</li><li>读写隔离（主从模式等）</li><li>快慢隔离</li><li>动静隔离（CDN）</li><li>爬虫隔离</li><li>热点隔离（秒杀、抢购做成独立系统或服务隔离，对于读热点，可以使用多级缓存，对于写热点，可以使用缓存+队列模式削峰，）</li><li>资源隔离</li><li>环境隔离（测试环境、预发布环境、灰度环境、正式环境）</li><li>压测隔离（真实数据、压测数据）</li><li>AB 测试</li><li>缓存隔离</li><li>查询隔离（简单、批量、复杂条件查询分别路由到不同集群）</li><li>使用 Hystrix 隔离</li><li>基于 Servlet 3 实现请求隔离</li></ul><h3 id="4-限流"><a href="#4-限流" class="headerlink" title="4. 限流"></a>4. 限流</h3><p>一般幵发高并发系统常见的限流有：限制总并发数（比如数据库连接池、线程池）、 限制瞬时并发数（如Nginx的limit_conn模块，用来限制瞬时并发连接数）、限制时间 窗口内的平均速率（如Guava的RateLimiter、Nginx的limit_req模块，用来限制每秒的 平均速率），以及限制远程接口调用速率、限制MQ的消费速率等。另外，还可以根据 网络连接数、网络流量、CPU或内存负载等来限流。</p><p><strong>限流算法：</strong></p><ul><li>令牌桶算法</li><li>漏桶算法</li><li>计数器算法</li></ul><p><strong>应用级限流：</strong></p><ul><li>限流总并发、连接、请求数（限制 TPS、QPS）</li><li>限流总资源数（池化，如数据库连接池、线程池）</li><li>限流某个接口的总并发、请求数（使用AtomicLong或者Semaphore进行限流，Hystrix）</li><li>限流某个接口的时间窗请求数（如使用Guava Cache来存储计数器）</li><li>平滑限流某个接口的请求数（Guava RateLimiter）</li></ul><p><strong>分布式限流</strong></p><p>分布式限流最关键的是要将限流服务做成原子化，解决方案可以使用 Redis+Lua 或者 Nginx+Lua 技术进行实现</p><p><strong>接入层限流</strong></p><p>接入层通常指请求流量的入口，主要目的有：负载均衡、非法请求过滤、请求聚合、缓存、降级、限流、A/B测试、服务质量监控等。<br>Nginx接入层限流可以使用 Nginx 自带的两个模块：连接数限流模块 ngx_http_limit_conn_module 和漏桶算法实现的请求限流模块 ngx_http_limit_req_module，或者 OpenResty 提供的 Lua 限流模块 lua-resty-limit-traffic</p><p><strong>节流</strong></p><p>防止多个相同事件连续重复执行，主要有throttleFirst、throttleLast、throttleWithTimeout</p><h3 id="5-降级特技"><a href="#5-降级特技" class="headerlink" title="5. 降级特技"></a>5. 降级特技</h3><p>降级的最终目的是保证核心服务可用，即使是有损的。<br>降级需要根据系统的吞吐量、响应时间、可用率等条件进行手工降级或自动降级。</p><h5 id="5-1-降级预案"><a href="#5-1-降级预案" class="headerlink" title="5.1 降级预案"></a>5.1 <strong>降级预案</strong></h5><p>自动开关降级/人工开关降级，读服务降级/写服务降级，多级降级，页面降级/页面片段降级/页面异步请求降级/服务功能降级/读降级/写降级/爬虫降级/风控降级</p><h5 id="5-2-自动开关降级"><a href="#5-2-自动开关降级" class="headerlink" title="5.2 自动开关降级"></a>5.2 <strong>自动开关降级</strong></h5><ul><li>超时降级</li><li>统计失败次数降级</li><li>故障降级</li><li>限流降级</li></ul><h5 id="5-3-人工开关降级"><a href="#5-3-人工开关降级" class="headerlink" title="5.3 人工开关降级"></a>5.3 <strong>人工开关降级</strong></h5><h5 id="5-4-读服务降级"><a href="#5-4-读服务降级" class="headerlink" title="5.4 读服务降级"></a>5.4 <strong>读服务降级</strong></h5><h5 id="5-5-写服务降级"><a href="#5-5-写服务降级" class="headerlink" title="5.5 写服务降级"></a>5.5 <strong>写服务降级</strong></h5><h5 id="5-6-多级降级"><a href="#5-6-多级降级" class="headerlink" title="5.6 多级降级"></a>5.6 <strong>多级降级</strong></h5><ul><li>页面 js 降级开关</li><li>接入层降级开关</li><li>应用层降级开关</li></ul><h5 id="5-7-配置中心（通过配置方式动态开启-关闭降级开关）"><a href="#5-7-配置中心（通过配置方式动态开启-关闭降级开关）" class="headerlink" title="5.7. 配置中心（通过配置方式动态开启/关闭降级开关）"></a>5.7. <strong>配置中心</strong>（通过配置方式动态开启/关闭降级开关）</h5><ul><li>应用层 API 封装</li><li>使用配置文件实现开关配置</li><li>使用配置中心实现开关配置</li></ul><h5 id="5-8-使用-Hystrix-实现降级"><a href="#5-8-使用-Hystrix-实现降级" class="headerlink" title="5.8. 使用 Hystrix 实现降级"></a>5.8. <strong>使用 Hystrix 实现降级</strong></h5><h5 id="5-9-使用-Hystrix-实现熔断"><a href="#5-9-使用-Hystrix-实现熔断" class="headerlink" title="5.9. 使用 Hystrix 实现熔断"></a>5.9. <strong>使用 Hystrix 实现熔断</strong></h5><h3 id="6-超时与重试机制"><a href="#6-超时与重试机制" class="headerlink" title="6. 超时与重试机制"></a>6. 超时与重试机制</h3><p><strong>代理层超时与重试</strong></p><p>如Haproxy/Nginx/Twemproxy，需设置代理与后端真实服务器之间的网络连接/读/写超时时间</p><p><strong>Web 容器超时</strong></p><p>提供HTTP服务运行环境的，如Tomcat/Jetty，需设置客户端与容器之间的网络连接/读/写超时时间，和在此容器中默认 socket 网络连接/读/写超时时间</p><p><strong>中间件客户端超时与重试</strong></p><p>如 Dubbo、MQ、HttpClient 等，需设置客户的网络连接/读/写超时时间与失败重试机制</p><p><strong>数据库客户端超时</strong></p><p>如MySQL/Oracle/PG，需要分别设置JDBC Connection、Statement的网络连接/读/写超时时间，事务超时时间，获取连接池等待时间</p><p><strong>NOSQL客户端超时</strong></p><p>如Mongo、Redis，需要设置其网络连接/读/写超时时间，获取连接池等待时间</p><p><strong>业务超时</strong></p><p>如订单取消任务、超时活动关闭，还有如Future#get(timeout, unix)限制某个接口的超时时间</p><p><strong>前端Ajax超时</strong></p><p>浏览器通过Ajax访问时的网络连接/读/写超时时间</p><p><strong>总结：</strong></p><blockquote><p>最重要的是网络相关的超时设置。<br>    超时后应该有相应的处理策略，如重试(稍后再试、尝试其它分组服务、尝试其它机房服务)、摘掉不存活节点(负载均衡/分布式缓存场景下)、托底(返回历史数据/静态数据/缓存数据)、等待页或错误页。<br>    对于非幂等写服务应避免重试，可以提前生成唯一流水号保证写服务操作通过流水号来实现幂等操作。<br>    在进行DB/缓存服务器操作时，需经常检查慢查询，同时在超时严重时，可以直接将该服务降级。<br>    对于有负载均衡的中间件，考虑配置心跳/存活检查。</p></blockquote><h3 id="7-回滚机制"><a href="#7-回滚机制" class="headerlink" title="7. 回滚机制"></a>7. 回滚机制</h3><p>回滚是指当程序或数据出错时，将程序和数据恢复到最近的一个正确版本的行为。常见的如事务回滚、代码库回滚、部署版本回滚、数据版本回滚、静态资源版本回滚等。</p><h5 id="7-1-事务回滚"><a href="#7-1-事务回滚" class="headerlink" title="7.1 事务回滚"></a>7.1 事务回滚</h5><p>单库事务回滚直接使用相关 SQL，分布式数据库可以使用分布式事务，如两阶段提交、三阶段提交协议。另外可以考虑入事务表、消息队列、补偿机制(执行/回滚)、TCC 模式(预占/确认/取消)、Sagas模式(拆分事务+补偿机制)等实现最终一致性。</p><h5 id="7-2-代码库回滚"><a href="#7-2-代码库回滚" class="headerlink" title="7.2 代码库回滚"></a>7.2 代码库回滚</h5><p>Git/SVN</p><h5 id="7-3-部署版本回滚"><a href="#7-3-部署版本回滚" class="headerlink" title="7.3 部署版本回滚"></a>7.3 部署版本回滚</h5><p>部署版本化、小版本增量发布、大版本灰度发布、架构升级并发发布</p><h5 id="7-4-数据版本回滚"><a href="#7-4-数据版本回滚" class="headerlink" title="7.4 数据版本回滚"></a>7.4 数据版本回滚</h5><p>设计版本化数据结构时，有全量和增量两种思路</p><h5 id="7-5-静态资源版本回滚"><a href="#7-5-静态资源版本回滚" class="headerlink" title="7.5 静态资源版本回滚"></a>7.5 静态资源版本回滚</h5><p>全量新版本保证版本可追溯。清理CDN 缓存，在新 URL上添加随机数并清理浏览器缓存。请求参数加上版本号</p><h3 id="8-压测与预案"><a href="#8-压测与预案" class="headerlink" title="8. 压测与预案"></a>8. 压测与预案</h3><p>在大促来临之前，研发人员需要对现有系统进行梳理，发现系统瓶颈和问题，然后 进行系统调优来提升系统的健壮性和处理能力。一般通过系统压测来发现系统瓶颈和问 题，然后进行系统优化和容灾（如系统参数调优、单机房容灾、多机房容灾等）。即使 己经把系统优化和容灾做得非常好了，但也存在一些不稳定因素，如网络、依赖服务的 SLA不稳定等，这就需要我们制定应急预案，在出现这些因素后进行路由切换或降级处 理。在大促之前需要进行预案演习，确保预案的有效性。</p><h5 id="8-1-系统压测"><a href="#8-1-系统压测" class="headerlink" title="8.1 系统压测"></a>8.1 <strong>系统压测</strong></h5><p>一般指性能压力测试，评估系统的稳定性和性能，通过压测数据进行系统容量评估，决定是否需要扩容和缩容。压测要有压测方案 {如压测接口、并发量、压测策略（突发、逐步加压、并发量）、压测指标（机器负载、QPS/TPS、响应时间）}，之后产出压测报告{压测方案、机器负载、QPSTPS、响应时间(avg、min、max)、成功率、相关参数(JVM参数、压缩参数)等}，根据压测报告分析的结果进行系统优化和容灾。</p><ul><li>线下压测(使用Jmeter、Apache ab 压测某个接口或某个组件(如DB 连接池)，然后进行调优，实现单个接口或组件性能最优。线下压测环境和线上不同，适合组件级压测，数据只能参考)</li><li>线上压测(按读写分为读压测、写压测、混合压测，按数据仿真度分为仿真压测和引流压测(如TCPCopy)，按是否给用户提供服务分为隔离集群压测和线上集群压测。注意离散压测(选择的数据应该是分散的或长尾的)和全链路压测)</li></ul><h5 id="8-2-系统优化和容灾"><a href="#8-2-系统优化和容灾" class="headerlink" title="8.2 系统优化和容灾"></a>8.2 <strong>系统优化和容灾</strong></h5><p>拿到压测报告后，接下来分析报告，然后进行有针对性的优化，如硬件升级、系统扩容、参数调优、代码优化、架构优化(如加缓存、读写分离、历史数据归档)等，根据压测数据因地制宜地解决。在系统优化时，要进行代码走查，发现不合理的参数配置，如超时时间、降级策略、缓存时间等。在系统压测时进行慢查询排查，如Redis、MySQL等。在应用系统扩容方面，根据往年流量和运营业务方沟通，评估是否需要扩容及扩容容量。扩容时考虑系统容灾，如分组部署、跨机房部署等，保证高可用。</p><h5 id="8-3-应急预案"><a href="#8-3-应急预案" class="headerlink" title="8.3 应急预案"></a>8.3 <strong>应急预案</strong></h5><p>在系统压测后会发现一些系统瓶颈，在系统优化之后会提升系统吞吐量并降低响应时间，容灾之后的系统可用性得以保障，但还存在一些风险，如网络抖动、某台机器负载过高、某个服务变慢、DB load值过高等，为了防止因为这些问题导致系统雪崩，需要制定应急预案。</p><p><strong>应急预案可分几步执行：</strong></p><ul><li>系统分级(划分交易核心系统和交易支撑系统，对不同级别的系统实施不同的质量保障)</li><li>全链路分析(从用户入口到后端存储，梳理出关键路径，进行评估和预案，防止问题的级联效应和雪崩效应)</li><li>配置监控报警</li><li>制定应急预案</li></ul><blockquote><p>最后，要对关联路径实施监控报警，包括服务器监控（CPU使用率、磁盘使用率、网络带宽等）、系统监控（系统存活、URL 状态/内容监控、端口存活等）、JVM 监控（堆内存、GC 次数、线程数等）、接口监控（接口调用量『每秒/每分钟』、接口性能『TOP50/TOP99/TOP999』、接口可用率等）。然后配置报警策略，如监控时间段、报警阈值、通知方式等。在报警后要观察系统状态、监控数据或者日志来查看系统是否真的存在故障，如果确实是故障，则应即及时执行相关预案处理，避免故障扩散。</p></blockquote><h1 id="第三部分-高并发"><a href="#第三部分-高并发" class="headerlink" title="第三部分 高并发"></a>第三部分 高并发</h1><h3 id="9-应用级缓存"><a href="#9-应用级缓存" class="headerlink" title="9. 应用级缓存"></a>9. 应用级缓存</h3><h5 id="9-1-缓存简介"><a href="#9-1-缓存简介" class="headerlink" title="9.1 缓存简介"></a>9.1 缓存简介</h5><p>让数据更接近于使用者，目的是让访问速度更快。</p><h5 id="9-2-缓存命中率"><a href="#9-2-缓存命中率" class="headerlink" title="9.2 缓存命中率"></a>9.2 缓存命中率</h5><p>从缓存中读取数据的次数与总读取次数的比率，命中率越高越好。<br>缓存命中率 = 从缓存中读取次数/总读取次数(从缓存中读取次数+从慢速设备上读取次数)</p><h5 id="9-3-缓存回收策略"><a href="#9-3-缓存回收策略" class="headerlink" title="9.3 缓存回收策略"></a>9.3 缓存回收策略</h5><ul><li>基于空间：设置缓存存储空间，超过空间上限时回收</li><li>基于容量：设置缓存最大数量大小</li><li>基于时间：TTL(Time To Live 存活期)，TTI(Time To Idle 空闲期)</li><li>基于 Java 对象引用：软引用，弱引用</li><li>回收算法：<ul><li>FIFO(First In First out 先进先出算法)</li><li>LRU(Least Recently Used 最近最少使用算法)</li><li>LFU(Least Frequently Used 最不常用算法)</li><li>实际应用中基于 LRU 的缓存居多，如 Guava Cache、Ehcache 等</li></ul></li></ul><h5 id="9-4-Java-缓存类型"><a href="#9-4-Java-缓存类型" class="headerlink" title="9.4 Java 缓存类型"></a>9.4 Java 缓存类型</h5><ul><li>堆缓存：使用Java堆内存来存储缓存对象，好处是没有序列号/反序列化，速度最快。缺点是缓存数据量很大时，GC 暂停时间会变长，存储容量受限于堆空间大小，一般通过软引用/弱引用来存储缓存对象，这样堆内存不足时可以强制回收这部分内存。一般存储较热的数据。</li><li>堆外缓存：存储在堆外内存，可以减少 GC 暂停时间，可以支持更大的缓存空间，但读取数据需要序列化/反序列化，速度较慢。</li><li>磁盘缓存：缓存存在磁盘上，在 JVM 重启时缓存还在，而堆缓存/堆外缓存会丢失，需重新加载。</li><li><p>分布式缓存：与上面的进程内缓存和磁盘缓存不同，多 JVM 实例。可以使用Redis/Ehcache-clustered等实现。</p><pre><code>两种模式:* 单机时：存储最热的数据到堆缓存，相对热的数据到堆外缓存，不热的数据到磁盘缓存* 集群时：存储最热的数据到堆缓存，相对热的数据到堆外缓存，全量数据到分布式缓存</code></pre></li></ul><h5 id="9-5-缓存使用模式"><a href="#9-5-缓存使用模式" class="headerlink" title="9.5 缓存使用模式"></a>9.5 缓存使用模式</h5><p>主要分两大类：Cache-Aside 和 Cache-As-SoR(Read-through、Write-through、Write-behind)</p><p><strong>三个名词</strong>  </p><ul><li>SoR(system-of-record)：记录系统，又叫数据源，即实际存储原始数据的系统</li><li>Cache：缓存，是 SoR 的快照数据，访问速度比 SoR快，放入 Cache 目的是提升访问速度，减少回源到 SoR 的次数</li><li>回源：即回到数据源头获取数据，Cache 没有命中时，需要从 SoR 读取数据。</li></ul><p><strong>缓存使用模式：</strong></p><ul><li>Cache-Aside：业务代码围绕着 Cache 写，是由业务代码直接维护缓存。读场景，先从缓存获取数据，如果没有命中，则回源到 SoR 并将源数据放入缓存供下次读取使用。写场景，先将数据写入 SoR，写入成功后立即将数据同步写入缓存。适合使用 AOP 模式实现。</li><li>Cache-As-SoR：把 Cache 看作为 SoR，所有操作都是对 Cache 进行，然后 Cache 委托给 SoR 进行真实的读写。业务代码中只看到 Cache 的操作，看不到关于 SoR 相关的代码。</li><li>Read-Through：业务代码首先调用 Cache，如果不命中由Cache回源到 SoR。需要配置一个 CacheLoader 组件用来回源到 SoR 加载源数据。</li><li>Write-Through：穿透写模式/直写模式，业务代码首先调用 Cache 写数据，然后由 Cache 负责写缓存和写 SoR，而不是由业务代码。需要配置一个 CacheWriter 组件用来回写 SoR。</li><li>Write-Behind：也叫 Write-Back，回写模式。不同于Write-Through是同步写 SoR 和 Cache，它是异步写，异步之后可以实现批量写、合并写、延时和限流。</li><li>Copy pattern：有 Copy-On-Read(在读时复制) 和 Copy-On-Write(在写时复制)两种。</li></ul><h5 id="9-6-性能测试"><a href="#9-6-性能测试" class="headerlink" title="9.6 性能测试"></a>9.6 性能测试</h5><p>使用 JMH 进行基准性能测试。首先进行 JVM 预热，然后进行度量，产生测试结果。</p><h3 id="10-HTTP-缓存"><a href="#10-HTTP-缓存" class="headerlink" title="10. HTTP 缓存"></a>10. HTTP 缓存</h3><h5 id="10-1-HTTP-缓存简介"><a href="#10-1-HTTP-缓存简介" class="headerlink" title="10.1 HTTP 缓存简介"></a>10.1 HTTP 缓存简介</h5><p>当用浏览器访问网页或 HTTP 服务时，根据服务器端返回的缓存设置响应头将相应内容缓存到浏览器，下次可以直接使用缓存内容或者仅需要去服务器端验证内容是否过期即可。减少浏览器与服务器端之间来回传输的数据量，节省带宽以提升性能。</p><h5 id="10-2-HTTP-缓存"><a href="#10-2-HTTP-缓存" class="headerlink" title="10.2 HTTP 缓存"></a>10.2 HTTP 缓存</h5><ol><li>服务器端响应的 Last-Modified 会在下次请求时，将 If-Modified-Since 请求头带到服务器端进行文档是否修改的验证，如果没有修改就返回304，浏览器可以直接使用缓存内容</li><li>Cache-Control:max-age和 Expires 用户决定浏览器端内容缓存多久，即多久过期，过期后则删除缓存重新从服务器端获取最新的。</li><li>HTTP/1.1规范定义的 Cache-Control 优先级高于 HTTP/1.0规范定义的 Expires</li><li>一般情况下 Expires=当前系统时间+缓存时间(Cache-Control:max-age)</li><li>HTTP/1.1规范定义 ETag 为“被请求变量的实体值”，可简单理解为文档内容摘要，ETag 可用来判断页面内容是否已经被修改过了。</li></ol><h5 id="10-3-一些经验"><a href="#10-3-一些经验" class="headerlink" title="10.3 一些经验"></a>10.3 一些经验</h5><ul><li>只缓存200状态码的响应，像302等要根据实际场景决定，比如当系统出错时，自动302到错误页面，此时缓存302就不对了</li><li>有些也没不需要强一致，可以进行几秒的缓存。比如商品详情页展示的库存，可以缓存几秒钟。短时间的不一致对于用户来说没有影响的</li><li>JS/CSS/image等一些内容缓存时间可以设置为很久，比如1月甚至1年，通过在页面修改版本来控制过期</li><li>假设商品详情页异步加载的一些数据，使用 last-modified 进行过期控制，而服务器端做了逻辑修改，但内容是没有修改的，即内容的最后修改时间没变。若果想过期这些异步加载的数据，则可以考虑在商品详情页添加异步加载数据的版本号，通过添加版本号来加载最新的数据，或者将 last-modified 时间加1来解决，但这种情况下使用 ETag 是更好的选择</li><li>商品详情页异步加载的一些数据，可以考虑更长时间的缓存，比如1个月而不是几分钟。可以通过 MQ 将修改时间推送到商品详情页，从而实现按需过期数据</li><li>服务器端考虑使用 tmpfs 内存文件系统缓存、ssd 缓存，使用服务器端负载均衡算法一致性哈希来提升缓存命中率</li><li>缓存 key 要合理设计。比如去掉某些参数或排序参数，以保证代理层的缓存命中率；要有清理缓存的工具，出问题时能快速清理掉问题 key。</li><li>AB 测试/个性化需求时，要禁用掉浏览器缓存，但要考虑服务器端缓存</li><li>为了便于查找问题一般会在响应头中添加源服务器信息，如访问京东商品详情页会看到 ser 响应头，此投存储了源服务器 IP，以便出现问题时，知道哪台服务器有问题</li></ul><h3 id="11-多级缓存"><a href="#11-多级缓存" class="headerlink" title="11. 多级缓存"></a>11. 多级缓存</h3><p>缓存相关的问题有很多，如缓存算法、热点数据与更新缓存、更新缓存与原子性、缓存崩溃与快速恢复等。<br>多级缓存是指在整个系统架构的不同系统层级进行数据缓存，以提升访问效率。</p><p>典型的应用整体架构和流程如图：</p><p>￼<img src="/Users/amon/Library/Application Support/typora-user-images/E9FDE38F-8D19-4587-8308-6629648903FE/Pasted%20Graphic%201.png" alt="Pasted Graphic 1.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://ws1.sinaimg.cn/large/006tKfTcgy1g0orej4jg5j30m80m8my3.jpg&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;第一部分-概述&quot;&gt;&lt;a href=&quot;#第一部分-概述&quot; class=&quot;
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="架构" scheme="http://amonxu.com/tags/%E6%9E%B6%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>元宵节？说说这个越来越没存在感的节日</title>
    <link href="http://amonxu.com/2019/02/19/2019-02-19-Yuan-Xiao-Jie/"/>
    <id>http://amonxu.com/2019/02/19/2019-02-19-Yuan-Xiao-Jie/</id>
    <published>2019-02-19T13:06:01.000Z</published>
    <updated>2019-02-19T14:26:47.897Z</updated>
    
    <content type="html"><![CDATA[<p>元宵节，又名上元节、灯节、小正月，在我们老家的方言叫做过十五。</p><p>过十五算是第二大节日了，大概因为这一天很大程度上分担了清明节的一些事宜。这天的白天，家家户户男女老少们全家出动，拿上铁锹扫帚，带上烟花爆竹，去修缮修缮祖坟，除一除草，打扫打扫卫生。如果祖坟是土坟的话，还在附近用铁锹挖一顶“官帽”，戴在坟墓的顶上。等打扫的差不多的时候，烧纸的开始烧纸，放炮的放炮，烟花爆竹一阵噼里啪啦，子子孙孙齐齐跪下，对着一座座坟墓叫着陌生的称呼。</p><p>这一天，上述的事情大多要反复执行几次，比如谁谁谁他爷爷的，谁谁谁他奶奶的，他爷爷的爸爸的，他爷爷的妈妈的，他爷爷的爷爷的，他爷爷的奶奶的… 因为家户不大，大多也就只能追溯到往上4、5代。</p><p>如此这般，白天的任务算是结束了，到了夜晚，才是过十五的高潮开始。等到六七点钟天黑的时候，家家户户又张起了灯，往祖坟前送去，俗称“送灯”，送灯大概的意思是为祖先们照亮回家的路。</p><p>如果说除夕的时候，只是断断续续打持久战般地，不停有人家放烟花，那么过十五就是密集的轰炸战，所有人家都拿出自家所有的烟花爆竹，然后一个劲地在祖坟前放掉。</p><p>这一晚的这个时候，黑夜如白昼，整个世界都是一个大的烟花展，到处是五颜六色各式各样的烟花，一家放的比一家多，一家放的比一家好看。直放到耳朵起茧子，脑中有回声，眼前一片花，空气中爆竹气味超标到无法呼吸。</p><p>这一天也是小孩子们快乐的一天，在此之前他们已经置备好了灯笼，有的是街上买的有电灯有音乐的，有的是买的装蜡烛点亮的，实在没有买的就自己用白酒盒子做一个灯笼，然后里面插上蜡烛。等到黑夜来临的时候，他们纷纷点上蜡烛，然后提着灯笼到处乱窜。嚯，谁的灯笼有跑马灯啦，谁的灯笼会唱歌啦，谁的灯笼烧着了啦。</p><p>等到夜开始深的时候，爆竹声也渐渐低了下来，偶尔的一两声爆竹，在空荡荡的乡下反复地回声着，显得特别落寞。人们陆续回家，宣告过十五的结束。也宣告着春节的结束。</p><p>我还挺怀念那个背着铁锹去墓地里上坟，闻着满鼻子的爆竹味打着灯笼到处跑的日子。可回想起来，自从上大学后，就再也没有在家里过元宵节。</p><p>元宵节到了现在，索性快要成为一个汤圆节，说起元宵节除了吃汤圆好像也不知道要做什么。<br>那么为什么会成为这样呢？我猜想有以下几个原因：</p><ol><li>过节不放假。不放假的节日都是耍流氓，上班都努力工作去了，谁还记得节日？(手动狗头)</li><li>没有宣传。比如商场超市没有像端午中秋圣诞那种促销活动和宣传，导致大众对元宵节的感觉越来越淡。</li><li>时间点有点尴尬。刚过完春节，大家有的还没从假日综合症中走出来，有的正是分道扬镳各奔东西的时候，元宵节的团圆也变得很难团圆。</li></ol><p>但愿那个把春节延长到元宵节的提议，早日被采纳实施吧！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;元宵节，又名上元节、灯节、小正月，在我们老家的方言叫做过十五。&lt;/p&gt;
&lt;p&gt;过十五算是第二大节日了，大概因为这一天很大程度上分担了清明节的一些事宜。这天的白天，家家户户男女老少们全家出动，拿上铁锹扫帚，带上烟花爆竹，去修缮修缮祖坟，除一除草，打扫打扫卫生。如果祖坟是土坟的
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="拾忆集" scheme="http://amonxu.com/tags/%E6%8B%BE%E5%BF%86%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>六年后，我明白了六年前上司的那次流泪</title>
    <link href="http://amonxu.com/2019/02/17/2019-02-17-Bye-Bye-JiangBo/"/>
    <id>http://amonxu.com/2019/02/17/2019-02-17-Bye-Bye-JiangBo/</id>
    <published>2019-02-17T15:00:01.000Z</published>
    <updated>2019-02-18T14:18:53.097Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.unsplash.com/photo-1525857222756-37cdb4e87e36?ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1650&amp;q=80" alt="ddd"></p><p>2013 年 6 月，故事的一切，看起来都很美好。</p><p>毕业一两年的我，正在第一家公司里贪婪地成长着，最近两个月刚刚得到提拔，负责公司新兴的业务。这一年，女朋友(现在的老婆)来到我在的这个城市一起生活，事业和爱情都飞速地发展着。</p><p>忽然有天听到一个消息：隔壁工位同部门的小兄弟江波要离职了，我有些愕然。江波是另一个项目的核心负责人之一，小小的个头隐藏着大大的能量。在我们同事之间平日里大言不惭地键盘侠、嘴炮党时，他常常发挥党员作用，说一些能让我们马上安静下来的道理。用现在的话说：他有一种老干部式的智慧。也因为他的老干部身份，每逢一些国际国内波动、社会变革、经济动荡的大议题出现时，我们都会争取让江波加入讨论之中，虽然…他经常嗤之以鼻。</p><p>江波在公司里他很低调，话也不多，每天上班准时背着运动双肩包出现，然后打一保温杯开水，开始一天的工作，等到下班又准时收拾双肩包走人。除非赶项目或者迫不得已，很少看到他在工位上加班。但他仍然是部门老大最喜爱的员工之一，他懂老大，老大也懂他，公认的前途无量。</p><p>我和江波工位虽处隔壁，但工作上并无什么交集，只有一次业务对接的时候，他的专业性让我敬佩不已，甚至很直接地指出了我工作任务中的一些问题，有些问题连我自己都没有想清楚过。从此更是对他暗暗多了几分佩服。</p><p>2013 年是移动互联网发展如火如荼的一年，尽管身处传统公司的我们很难感受到外面的互联网世界快速发展，但江波平日里最喜爱看 36kr 和  YC。在看多了他的这些举动后，我也暗暗地去关注这些，想去了解它们为何有如此魅力，不觉间也被带入了移动互联网的大浪潮里。</p><p><img src="https://images.unsplash.com/photo-1519671482749-fd09be7ccebf?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1350&amp;q=80" alt="drink"></p><p>送别江波的那天，部门里的所有成员都出席了送别宴。过去六年了，我还能记得那天的场景，昏黄的灯光，拥挤的位置，一杯接一杯的啤酒，和微醺的我们。大家言语不多，嘴里只是反复吐出一个字：干。</p><p>那一天，老大情绪有些激动，喝的最多。酒至深处之时，老大呜咽着感叹道：“我不知道为什么，有时候怎么这么难呢！”。大家听闻此言，顿时有些感伤，竟不知说些什么。江波也受了影响有些伤感，拍了拍老大的肩膀。</p><p>那时，我挤在人群之间，不会喝酒却在这一晚喝的有些迷糊。年轻的我，意气风发的我，看到这离别的场景，郁郁寡欢的人群，伤感的老大，我是错愕的，甚至有些想哑然失笑。老大啊老大，你三四十的人了，有家有室，风风雨雨也历经不少了，为何一个下属离职就让你哭成这样。</p><p>这一晚，大家没有谈到江波的未来，江波也没有主动交代，只依稀记得听人说有他去投入到创业大潮中的，有说他去互联网巨头公司的，有说他回老家的。</p><p>宴会结束后，很少喝酒的我带着一身酒气一个人走回了家，女朋友问为何今天破例喝酒，答曰：有个很好的同事离职了，我们一起送别他。    </p><p>江波走后，很快大家便把江波的工作分而食之，好像江波从来没有在过一样。连他的工位，也有另一个同事搬了过来，至今想起那个位置，一半的记忆是江波的，另一半的记忆是后面那个同事的。</p><p>2013 年在移动互联网的滚滚大潮中落下帷幕，2014 年是 O2O 和社交爆发的一年。江波离职的一年后，我也按捺不住，一头扎入了移动互联网的大浪潮中。再后来，浮浮沉沉，跌跌撞撞，成功过，失败过，团结后，孤独过，聚过，散过，相识过，相忘过… </p><p>现在，我已经快要忘记了江波，也快要忘记了那个老大，那个团队。活在当下，过去和历史就是一段虚无的记忆，除了回味，你无法证明它是否真的发生过。</p><p>除非…偶然翻起过去的老照片。当我看到一张张老照片，一张张熟悉的面孔，我才知道，这些东西都没有被遗忘，只是它们被压缩在大脑的最深处，当再次解压的时候，所有那些记忆都会释放迸发出来。</p><p><img src="https://images.unsplash.com/photo-1533158307587-828f0a76ef46?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1267&amp;q=80" alt="memory"></p><p>我又想起了老大的那次流泪，这次，我也有些伤感起来，甚至想流泪。当我想象自己是 2013 年的老大时，我哭了出来。2013 年到底是老大哭了，还是我哭了，他的流泪到底是他真的流泪，还是只是我现在的想象？</p><p>笑，世界陪你笑；哭，你一个人哭。</p><p>我曾以为江波走后，总会回来看我们的，直到我离开公司的时候，也没有见过他，甚至听不到他的任何消息。在我离开公司后，我知道人生路很长，却只有往前，没有向后看，前方的路已经够眼花缭乱，哪还有精力常回头看看。</p><p>人生苦短，相遇相识相知很难，此去一别，也许从此天各一方，再也不见。这大概就是老大那次流泪的原因吧。</p><p><img src="https://images.unsplash.com/photo-1529268209110-62be1d87fe75?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1350&amp;q=80" alt="bye"></p><p><em>后记：2013 年后至今，我再也没有联系过江波，更没见过他，也没有从别人那里打听到他的消息。2014 年后，我再也没有见过老大。某个深夜，我还是很想他们。</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://images.unsplash.com/photo-1525857222756-37cdb4e87e36?ixlib=rb-1.2.1&amp;amp;auto=format&amp;amp;fit=crop&amp;amp;w=1650&amp;amp;q=80&quot; a
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="拾忆集" scheme="http://amonxu.com/tags/%E6%8B%BE%E5%BF%86%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>iOS统计Push推送到达率</title>
    <link href="http://amonxu.com/2019/01/05/2019-01-05-iOS-Stat-Push/"/>
    <id>http://amonxu.com/2019/01/05/2019-01-05-iOS-Stat-Push/</id>
    <published>2019-01-05T14:02:33.000Z</published>
    <updated>2019-03-04T14:04:15.030Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.unsplash.com/photo-1546054454-aa26e2b734c7?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=800&amp;q=80" alt="cover"><br>众所周知，iOS 10 以后，苹果官方推出了<code>Notification Service Extension</code>，查看文档，<code>UNNotificationServiceExtension</code>的说明是，<code>An object that modifies the content of a remote notification before it&#39;s delivered to the user.</code>，也就是在一个远程通知展示给用户之前，可以通过<code>UNNotificationServiceExtension</code>来修改这个通知。</p><p>废话少说，直接开干吧。</p><h3 id="一、如何监听收到推送"><a href="#一、如何监听收到推送" class="headerlink" title="一、如何监听收到推送"></a>一、如何监听收到推送</h3><ol><li><p>在原有的项目上新建一个 Target，如图，选择创建<br><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1g0r2blpphqj30ka0emta3.jpg" alt="image-20190304210307444"></p></li><li><p>在服务端推送的内容中新增一个字段<code>mutable-content&quot;: &quot;1&quot;</code>，与<code>alert/badge/sound</code>处于同一层级。例如在推送平台中测试推送时，设置如下：<img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g0r2tlom16j30lt0igdh1.jpg" alt="image-20190304212029192"></p></li><li><p>先运行项目的主Target，然后再运行Notification Service Extension，手动选择主Target</p></li><li><p>发送测试推送，可以看到执行进入 Target 项目中的<code>- (void)didReceiveNotificationRequest:(UNNotificationRequest *)request withContentHandler:(void (^)(UNNotificationContent * _Nonnull))contentHandler</code></p></li></ol><h3 id="二、如何统计"><a href="#二、如何统计" class="headerlink" title="二、如何统计"></a>二、如何统计</h3><ol><li>如果是接入第三方推送平台，可以查看是否支持。如 <a href="https://docs.jiguang.cn/jpush/client/iOS/ios_api/#notification-service-extension" target="_blank" rel="noopener">极光的 Notification Service Extension 相关接口</a></li><li>如果自己实现的话，有以下两种方案<ol><li>在通知扩展项目中写网络请求，将推送到达数据发送到后端服务器</li><li>将推送到达数据通过<code>App Group</code>保存到 App 的本地，在主 Target 中再处理</li></ol></li></ol><h3 id="三、如何使用-App-Groud-实现数据共享"><a href="#三、如何使用-App-Groud-实现数据共享" class="headerlink" title="三、如何使用 App Groud 实现数据共享"></a>三、如何使用 App Groud 实现数据共享</h3><ol><li><p>在 <a href="https://developer.apple.com/account/ios/certificate/development" target="_blank" rel="noopener">https://developer.apple.com</a> 登录，创建 <code>App Group</code></p></li><li><p>在项目中配置，<code>target - Capabilites - App groups</code></p></li><li><p>代码中使用</p><ol><li><p>NSUserDefaults 中使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NSUserDefaults *userDefaults = [[NSUserDefaults alloc] initWithSuiteName:@&quot;group.company.appGroupName&quot;];</span><br><span class="line">// write data</span><br><span class="line">[userDefaults setValue:@&quot;value&quot; forKey:@&quot;key&quot;];</span><br><span class="line"></span><br><span class="line">//read data</span><br><span class="line">NSLog(@&quot;%@&quot;, [userDefaults valueForKey:@&quot;key&quot;]);</span><br></pre></td></tr></table></figure></li></ol></li></ol><ol start="2"><li><p>NSFileManager 中使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// write data</span><br><span class="line">NSURL *groupURL = [[NSFileManager defaultManager] containerURLForSecurityApplicationGroupIdentifier:@&quot;group.domain.groupName&quot;];</span><br><span class="line">NSURL *fileURL = [groupURL URLByAppendingPathComponent:@&quot;fileName&quot;];</span><br><span class="line">    </span><br><span class="line">NSString *text = @&quot;Go amonxu.com&quot;;</span><br><span class="line">if (![[NSFileManager defaultManager] fileExistsAtPath:fileURL.path]) &#123;</span><br><span class="line">        [text writeToURL:fileURL atomically:YES encoding:NSUTF8StringEncoding error:nil];</span><br><span class="line">&#125; else &#123;</span><br><span class="line">        NSFileHandle *fileHandle = [NSFileHandle fileHandleForUpdatingURL:fileURL error:nil];</span><br><span class="line">        [fileHandle seekToEndOfFile];</span><br><span class="line">        [fileHandle writeData:[text dataUsingEncoding:NSUTF8StringEncoding]];</span><br><span class="line">        [fileHandle closeFile];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// read data</span><br><span class="line">NSURL *groupURL = [[NSFileManager defaultManager] containerURLForSecurityApplicationGroupIdentifier:@&quot;group.domain.groupName&quot;];</span><br><span class="line">NSURL *fileURL = [groupURL URLByAppendingPathComponent:@&quot;fileName&quot;];</span><br><span class="line">NSString *fileContent = [NSString stringWithContentsOfURL:fileURL encoding:NSUTF8StringEncoding error:nil];</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://images.unsplash.com/photo-1546054454-aa26e2b734c7?ixlib=rb-1.2.1&amp;amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;amp;auto=format&amp;amp;fit=
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="iOS" scheme="http://amonxu.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>地铁里的孤独鸟</title>
    <link href="http://amonxu.com/2018/12/18/2018-12-18-Free-Bird/"/>
    <id>http://amonxu.com/2018/12/18/2018-12-18-Free-Bird/</id>
    <published>2018-12-18T13:07:00.000Z</published>
    <updated>2019-01-16T07:14:22.975Z</updated>
    
    <content type="html"><![CDATA[<p>早高峰的地铁里，<br>人群席卷了站台，<br>十秒后空无一人，<br>除了那只孤独的鸟。<br>她瘦削的身材，<br>高挑的气质，<br>两腿交叉在那，<br>静静地站着，<br>仿佛不属于这个世界。  </p><p>你<br>本是，<br>林中鸟，<br>溪中水，<br>山涧清风，<br>田中野兔，<br>你在这里，<br>带来谁的问候，<br>带走谁的孤独？  </p><p>列车越渐快速的远行，<br>她的身影被拉的愈发修长，<br>她仍低头兀自欣赏自己，<br>列车没能带走了她，<br>她却带走了路人的心。  </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;早高峰的地铁里，&lt;br&gt;人群席卷了站台，&lt;br&gt;十秒后空无一人，&lt;br&gt;除了那只孤独的鸟。&lt;br&gt;她瘦削的身材，&lt;br&gt;高挑的气质，&lt;br&gt;两腿交叉在那，&lt;br&gt;静静地站着，&lt;br&gt;仿佛不属于这个世界。  &lt;/p&gt;
&lt;p&gt;你&lt;br&gt;本是，&lt;br&gt;林中鸟，&lt;br&gt;溪中水，&lt;b
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="随笔" scheme="http://amonxu.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>JVM性能调优监控工具jps、jstack、jmap、jhat、jstat、hprof使用详解</title>
    <link href="http://amonxu.com/2018/11/25/2018-11-25-jvm-performance-optimize/"/>
    <id>http://amonxu.com/2018/11/25/2018-11-25-jvm-performance-optimize/</id>
    <published>2018-11-25T14:14:15.000Z</published>
    <updated>2019-01-16T07:47:27.807Z</updated>
    
    <content type="html"><![CDATA[<p>原文链接：<a href="https://my.oschina.net/feichexia/blog/196575" target="_blank" rel="noopener">https://my.oschina.net/feichexia/blog/196575</a></p><p>JVM 性能调优参考资料：</p><p>《Java虚拟机规范》</p><p>《Java Performance》</p><p>《Trouble Shooting Guide for JavaSE 6 with HotSpot VM》: <a href="http://www.oracle.com/technetwork/java/javase/tsg-vm-149989.pdf" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/tsg-vm-149989.pdf</a> </p><p>《Effective Java》</p><p>VisualVM: <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/visualvm/" target="_blank" rel="noopener">http://docs.oracle.com/javase/7/docs/technotes/guides/visualvm/</a></p><p>jConsole: <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/management/jconsole.html" target="_blank" rel="noopener">http://docs.oracle.com/javase/1.5.0/docs/guide/management/jconsole.html</a></p><p>Monitoring and Managing JavaSE 6 Applications: <a href="http://www.oracle.com/technetwork/articles/javase/monitoring-141801.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/articles/javase/monitoring-141801.html</a></p><p>BTrace：<a href="https://kenai.com/projects/btrace" target="_blank" rel="noopener">https://kenai.com/projects/btrace</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;原文链接：&lt;a href=&quot;https://my.oschina.net/feichexia/blog/196575&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://my.oschina.net/feichexia/blog/196575&lt;/
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="Java" scheme="http://amonxu.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>如何避免后台IO高负载造成的长时间JVM GC停顿</title>
    <link href="http://amonxu.com/2018/11/24/2018-11-24-eliminating-large-jvm-gc-pauses-caused-by-background-io-traffic/"/>
    <id>http://amonxu.com/2018/11/24/2018-11-24-eliminating-large-jvm-gc-pauses-caused-by-background-io-traffic/</id>
    <published>2018-11-24T13:30:31.000Z</published>
    <updated>2019-01-16T07:47:27.805Z</updated>
    
    <content type="html"><![CDATA[<p>英文原文：<br><a href="https://engineering.linkedin.com/blog/2016/02/eliminating-large-jvm-gc-pauses-caused-by-background-io-traffic" target="_blank" rel="noopener">https://engineering.linkedin.com/blog/2016/02/eliminating-large-jvm-gc-pauses-caused-by-background-io-traffic</a></p><p>译文原文：<br><a href="https://www.jianshu.com/p/ce9b3f0a90f2" target="_blank" rel="noopener">https://www.jianshu.com/p/ce9b3f0a90f2</a></p><p>这里就只贴出结论总结吧：</p><p>有低延迟要求的Java应用程序需要极短的JVM GC停顿。但是，当磁盘IO压力很大时，JVM可能被阻塞一段较长的时间。</p><p>我们对该问题进行了调查，并且发现如下原因：</p><ol><li>JVM GC需要通过发起系统调用<code>write()</code>，来记录GC行为。</li><li><code>write()</code>调用可以被后台磁盘IO所阻塞。</li><li>记录GC日志属于JVM停顿的一部分，因此<code>write()</code>调用的时间也会被计算在JVM STW的停顿时间内。<br>我们提出了一系列解决该问题的方案。重要的是，我们的发现可以帮助JVM实现来改进该问题。对于低延迟应用程序来说，最简单有效的措施是将GC日志文件放到单独的HDD或者高性能磁盘（例如SSD）上，来避免IO竞争。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;英文原文：&lt;br&gt;&lt;a href=&quot;https://engineering.linkedin.com/blog/2016/02/eliminating-large-jvm-gc-pauses-caused-by-background-io-traffic&quot; target=&quot;
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="Java" scheme="http://amonxu.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>快速排查 Java 的 CPU 性能问题</title>
    <link href="http://amonxu.com/2018/11/23/2018-11-23-Java-Script/"/>
    <id>http://amonxu.com/2018/11/23/2018-11-23-Java-Script/</id>
    <published>2018-11-23T10:45:46.000Z</published>
    <updated>2019-01-16T07:47:27.802Z</updated>
    
    <content type="html"><![CDATA[<!-- START doctoc generated TOC please keep comment here to allow auto update --><!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --><ul><li><a href="#-show-busy-java-threads">🍺 show-busy-java-threads</a><ul><li><a href="#%E7%94%A8%E6%B3%95">用法</a></li><li><a href="#%E7%A4%BA%E4%BE%8B">示例</a></li></ul></li></ul><!-- END doctoc generated TOC please keep comment here to allow auto update --><p><a id="beer-show-busy-java-threadssh"></a><br><a id="beer-show-busy-java-threads"></a></p><h2 id="🍺-show-busy-java-threads"><a href="#🍺-show-busy-java-threads" class="headerlink" title="🍺 show-busy-java-threads"></a>🍺 <a href="https://github.com/oldratlee/useful-scripts/blob/master/show-busy-java-threads" target="_blank" rel="noopener">show-busy-java-threads</a></h2><p>用于快速排查<code>Java</code>的<code>CPU</code>性能问题(<code>top us</code>值过高)，自动查出运行的<code>Java</code>进程中消耗<code>CPU</code>多的线程，并打印出其线程栈，从而确定导致性能问题的方法调用。<br>目前只支持<code>Linux</code>。原因是<code>Mac</code>、<code>Windows</code>的<code>ps</code>命令不支持列出进程的线程<code>id</code>，更多信息参见<a href="https://github.com/oldratlee/useful-scripts/issues/33" target="_blank" rel="noopener">#33</a>，欢迎提供解法。</p><p>PS，如何操作可以参见<a href="http://weibo.com/bluedavy" target="_blank" rel="noopener">@bluedavy</a>的<a href="https://book.douban.com/subject/4848587/" target="_blank" rel="noopener">《分布式Java应用》</a>的【5.1.1 <code>CPU</code>消耗分析】一节，说得很详细：</p><ol><li><code>top</code>命令找出有问题<code>Java</code>进程及线程<code>id</code>：<ol><li>开启线程显示模式（<code>top -H</code>，或是打开<code>top</code>后按<code>H</code>）</li><li>按<code>CPU</code>使用率排序（<code>top</code>缺省是按<code>CPU</code>使用降序，已经合要求；打开<code>top</code>后按<code>P</code>可以显式指定按<code>CPU</code>使用降序）</li><li>记下<code>Java</code>进程<code>id</code>及其<code>CPU</code>高的线程<code>id</code></li></ol></li><li>用进程<code>id</code>作为参数，<code>jstack</code>有问题的<code>Java</code>进程</li><li>手动转换线程<code>id</code>成十六进制（可以用<code>printf %x 1234</code>）</li><li>查找十六进制的线程<code>id</code>（可以用<code>vim</code>的查找功能<code>/0x1234</code>，或是<code>grep 0x1234 -A 20</code>）</li><li>查看对应的线程栈，以分析问题</li></ol><p>查问题时，会要多次上面的操作以分析确定问题，这个过程<strong>太繁琐太慢了</strong>。</p><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">show-busy-java-threads</span><br><span class="line"><span class="comment"># 从所有运行的Java进程中找出最消耗CPU的线程（缺省5个），打印出其线程栈</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺省会自动从所有的Java进程中找出最消耗CPU的线程，这样用更方便</span></span><br><span class="line"><span class="comment"># 当然你可以手动指定要分析的Java进程Id，以保证只会显示出那个你关心的那个Java进程的信息</span></span><br><span class="line">show-busy-java-threads -p &lt;指定的Java进程Id&gt;</span><br><span class="line"></span><br><span class="line">show-busy-java-threads -c &lt;要显示的线程栈数&gt;</span><br><span class="line"></span><br><span class="line">show-busy-java-threads &lt;重复执行的间隔秒数&gt; [&lt;重复执行的次数&gt;]</span><br><span class="line"><span class="comment"># 多次执行；这2个参数的使用方式类似vmstat命令</span></span><br><span class="line"></span><br><span class="line">show-busy-java-threads -a &lt;运行输出的记录到的文件&gt;</span><br><span class="line"><span class="comment"># 记录到文件以方便回溯查看</span></span><br><span class="line"></span><br><span class="line">show-duplicate-java-classes -S &lt;存储jstack输出文件的目录&gt;</span><br><span class="line"><span class="comment"># 指定jstack输出文件的存储目录，方便记录以后续分析</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment"># 如果Java进程的用户 与 执行脚本的当前用户 不同，则jstack不了这个Java进程</span></span><br><span class="line"><span class="comment"># 为了能切换到Java进程的用户，需要加sudo来执行，即可以解决：</span></span><br><span class="line">sudo show-busy-java-threads</span><br><span class="line"></span><br><span class="line">show-busy-java-threads -s &lt;指定jstack命令的全路径&gt;</span><br><span class="line"><span class="comment"># 对于sudo方式的运行，JAVA_HOME环境变量不能传递给root，</span></span><br><span class="line"><span class="comment"># 而root用户往往没有配置JAVA_HOME且不方便配置，</span></span><br><span class="line"><span class="comment"># 显式指定jstack命令的路径就反而显得更方便了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -m选项：执行jstack命令时加上-m选项，显示上Native的栈帧，一般应用排查不需要使用</span></span><br><span class="line">show-busy-java-threads -m</span><br><span class="line"><span class="comment"># -F选项：执行jstack命令时加上 -F 选项（如果直接jstack无响应时，用于强制jstack），一般情况不需要使用</span></span><br><span class="line">show-busy-java-threads -F</span><br><span class="line"><span class="comment"># -l选项：执行jstack命令时加上 -l 选项，显示上更多相关锁的信息，一般情况不需要使用</span></span><br><span class="line"><span class="comment"># 注意：和 -m -F 选项一起使用时，可能会大大增加jstack操作的耗时</span></span><br><span class="line">show-busy-java-threads -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 帮助信息</span></span><br><span class="line">$ show-busy-java-threads -h</span><br><span class="line">Usage: show-busy-java-threads [OPTION]... [delay [count]]</span><br><span class="line">Find out the highest cpu consumed threads of java, and <span class="built_in">print</span> the stack of these threads.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line">  show-busy-java-threads       <span class="comment"># show busy java threads info</span></span><br><span class="line">  show-busy-java-threads 1     <span class="comment"># update every 1 second, (stop by eg: CTRL+C)</span></span><br><span class="line">  show-busy-java-threads 3 10  <span class="comment"># update every 3 seconds, update 10 times</span></span><br><span class="line"></span><br><span class="line">Output control:</span><br><span class="line">  -p, --pid &lt;java pid&gt;      find out the highest cpu consumed threads from the specified java process,</span><br><span class="line">                            default from all java process.</span><br><span class="line">  -c, --count &lt;num&gt;         <span class="built_in">set</span> the thread count to show, default is 5.</span><br><span class="line">  -a, --append-file &lt;file&gt;  specifies the file to append output as <span class="built_in">log</span>.</span><br><span class="line">  -S, --store-dir &lt;dir&gt;     specifies the directory <span class="keyword">for</span> storing intermediate files, and keep files.</span><br><span class="line">                            default store intermediate files at tmp dir, and auto remove after run.</span><br><span class="line">                            use this option to keep files so as to review jstack/top/ps output later.</span><br><span class="line">  delay                     the delay between updates <span class="keyword">in</span> seconds.</span><br><span class="line">  count                     the number of updates.</span><br><span class="line">                            delay/count arguments imitates the style of vmstat <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">jstack control:</span><br><span class="line">  -s, --jstack-path &lt;path&gt;  specifies the path of jstack <span class="built_in">command</span>.</span><br><span class="line">  -F, --force               <span class="built_in">set</span> jstack to force a thread dump.</span><br><span class="line">                            use when jstack &lt;pid&gt; does not respond (process is hung).</span><br><span class="line">  -m, --mix-native-frames   <span class="built_in">set</span> jstack to <span class="built_in">print</span> both java and native frames (mixed mode).</span><br><span class="line">  -l, --lock-info           <span class="built_in">set</span> jstack with long listing. Prints additional information about locks.</span><br><span class="line"></span><br><span class="line">cpu usage calculation control:</span><br><span class="line">  -d, --top-delay           specifies the delay between top samples, default is 0.5 (second).</span><br><span class="line">                            get thread cpu percentage during this delay interval.</span><br><span class="line">                            more info see top -d option. eg: -d 1 (1 second).</span><br><span class="line">  -P, --use-ps              use ps <span class="built_in">command</span> to find busy thread(cpu usage) instead of top <span class="built_in">command</span>,</span><br><span class="line">                            default use top <span class="built_in">command</span>, because cpu usage of ps <span class="built_in">command</span> is expressed as</span><br><span class="line">                            the percentage of time spent running during the entire lifetime of a process,</span><br><span class="line">                            this is not ideal.</span><br><span class="line"></span><br><span class="line">Miscellaneous:</span><br><span class="line">  -h, --<span class="built_in">help</span>                display this <span class="built_in">help</span> and <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ show-busy-java-threads</span><br><span class="line">[1] Busy(57.0%) thread(23355/0x5b3b) stack of java process(23269) under user(admin):</span><br><span class="line"><span class="string">"pool-1-thread-1"</span> prio=10 tid=0x000000005b5c5000 nid=0x5b3b runnable [0x000000004062c000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">    at java.text.DateFormat.format(DateFormat.java:316)</span><br><span class="line">    at com.xxx.foo.services.common.DateFormatUtil.format(DateFormatUtil.java:41)</span><br><span class="line">    at com.xxx.foo.shared.monitor.schedule.AppMonitorDataAvgScheduler.run(AppMonitorDataAvgScheduler.java:127)</span><br><span class="line">    at com.xxx.foo.services.common.utils.AliTimer<span class="variable">$2</span>.run(AliTimer.java:128)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.runTask(ThreadPoolExecutor.java:886)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:908)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:662)</span><br><span class="line"></span><br><span class="line">[2] Busy(26.1%) thread(24018/0x5dd2) stack of java process(23269) under user(admin):</span><br><span class="line"><span class="string">"pool-1-thread-2"</span> prio=10 tid=0x000000005a968800 nid=0x5dd2 runnable [0x00000000420e9000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">    at java.util.Arrays.copyOf(Arrays.java:2882)</span><br><span class="line">    at java.lang.AbstractStringBuilder.expandCapacity(AbstractStringBuilder.java:100)</span><br><span class="line">    at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:572)</span><br><span class="line">    at java.lang.StringBuffer.append(StringBuffer.java:320)</span><br><span class="line">    - locked &lt;0x00000007908d0030&gt; (a java.lang.StringBuffer)</span><br><span class="line">    at java.text.SimpleDateFormat.format(SimpleDateFormat.java:890)</span><br><span class="line">    at java.text.SimpleDateFormat.format(SimpleDateFormat.java:869)</span><br><span class="line">    at java.text.DateFormat.format(DateFormat.java:316)</span><br><span class="line">    at com.xxx.foo.services.common.DateFormatUtil.format(DateFormatUtil.java:41)</span><br><span class="line">    at com.xxx.foo.shared.monitor.schedule.AppMonitorDataAvgScheduler.run(AppMonitorDataAvgScheduler.java:126)</span><br><span class="line">    at com.xxx.foo.services.common.utils.AliTimer<span class="variable">$2</span>.run(AliTimer.java:128)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.runTask(ThreadPoolExecutor.java:886)</span><br><span class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:908)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:662)</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>上面的线程栈可以看出，<code>CPU</code>消耗最高的2个线程都在执行<code>java.text.DateFormat.format</code>，业务代码对应的方法是<code>shared.monitor.schedule.AppMonitorDataAvgScheduler.run</code>。可以基本确定：</p><ul><li><code>AppMonitorDataAvgScheduler.run</code>调用<code>DateFormat.format</code>次数比较频繁。</li><li><code>DateFormat.format</code>比较慢。（这个可以由<code>DateFormat.format</code>的实现确定。）</li></ul><p>多执行几次<code>show-busy-java-threads</code>，如果上面情况高概率出现，则可以确定上面的判定。<br>因为调用越少代码执行越快，则出现在线程栈的概率就越低。<br>脚本有自动多次执行的功能，指定 重复执行的间隔秒数/重复执行的次数 参数。</p><p>分析<code>shared.monitor.schedule.AppMonitorDataAvgScheduler.run</code>实现逻辑和调用方式，以优化实现解决问题。</p><h4 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h4><blockquote><p>转载自 <a href="https://github.com/oldratlee/useful-scripts" target="_blank" rel="noopener">https://github.com/oldratlee/useful-scripts</a><br>致谢 <a href="https://github.com/oldratlee" target="_blank" rel="noopener">oldratlee</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- START doctoc generated TOC please keep comment here to allow auto update --&gt;
&lt;!-- DON&#39;T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPD
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="Java" scheme="http://amonxu.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>关于 Hash 比较好的一篇文章</title>
    <link href="http://amonxu.com/2018/11/22/2018-11-22-Hash/"/>
    <id>http://amonxu.com/2018/11/22/2018-11-22-Hash/</id>
    <published>2018-11-22T06:15:16.000Z</published>
    <updated>2019-01-16T07:47:27.800Z</updated>
    
    <content type="html"><![CDATA[<p>文章链接:<br><a href="https://www.hchstudio.cn/article/2018/799a/" target="_blank" rel="noopener">https://www.hchstudio.cn/article/2018/799a/</a></p><p>主要的散列冲突的解决办法</p><ul><li>开放寻址法</li><li>拉链法（链地址法）</li><li>再散列法</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;文章链接:&lt;br&gt;&lt;a href=&quot;https://www.hchstudio.cn/article/2018/799a/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.hchstudio.cn/article/2018/799a/
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="Java" scheme="http://amonxu.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>《平凡的世界》读后感</title>
    <link href="http://amonxu.com/2018/11/15/2018-11-15-Oridnary-World/"/>
    <id>http://amonxu.com/2018/11/15/2018-11-15-Oridnary-World/</id>
    <published>2018-11-15T13:28:00.000Z</published>
    <updated>2019-01-16T08:18:58.841Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1544113284671&amp;di=773633a67536c922954ac5b4bd81e549&amp;imgtype=0&amp;src=http%3A%2F%2Fy2.ifengimg.com%2Fcmpp%2F2014%2F01%2F21%2F14%2Fbe3f2868-4191-4e9b-b44d-370fd5e6ffd2.jpg" alt="cover"></p><p>故事从孙少平开始，少平在原西县城上高中，贫困的他每天等别人吃完饭后才去偷偷拿他的两个非洲黑馒头，后来和同拿非洲馒头的郝红梅同病相怜，成为知心朋友。在那个物质匮乏，思想贫瘠的时代，给予两个可怜的人莫大鼓励。</p><p>孙少安是生产队长，尽管他干农活在村里数一数二，但父母年迈，尚有老奶奶，弟弟妹妹上学，拖着一个贫困的家庭，在黄土地里的劳作最终也不能盈余一点。县城里有他青梅竹马的润叶，润叶叫他去县城见面，她必须要和他倾诉感情。</p><p>少安最后主动选择了消失，他认清了自己是个农民，并且以后也是农民，农民和小资产阶级是没有未来的。后来他娶了同是农民的贺秀莲，这辈子也算枕边有个相互照料的人。</p><p>田润叶是县城里的教师，寄托在二爸田福军的屋檐下，她和少安一样，无法摆脱所处阶级的禁锢，和舔狗李向前结婚。她根本不爱李向前，被李向前羞辱后一个人独过，直到李向前成为残疾后莫名其妙地圣母心发作，回去和他一起生活。</p><p>少平高中毕业后，去了黄原揽活，和田晓霞渐生情愫。原以为他会陷入到安排落户的曹书记的安排里，但他后面还是去了铜城煤矿，结识了可能相处一辈子的慧英嫂一家。</p><p>田晓霞和少平相互倾心，他们跨越了彼此的阶级鸿沟，尽管都不知未来会如何，但人生苦短及时享乐。路遥索性让他们没有未来，不管现实还是故事，这个阶级鸿沟谁也跨越不了。因为这不是爽文，是平凡的世界。平凡的世界谁也不是超级英雄，顶多是个平民英雄。少平洪水中救了侯玉英当了一回英雄，晓霞洪水中救小女孩当了烈士。</p><p>王满银，一个自以为读了点书不愿务农的二流子，一个敢革命时代搞资本主义的老鼠药贩子，一个不愿打柴干脆去田沟里晒太阳取暖的二傻子。打从放开资本主义和市场经济后，满银同志便走南闯北的逛，黄原、省城、上海，甚至南中国的深圳沙头角，他都能逛了去。如果不是海关拦着，他可能逛到香港去了，现在说不定就是个商业巨鳄、XX大王。忽然有一天他照了下镜子，岁月蹉跎容颜衰老，他意识到已经不是那个靠骚就勾引到兰花的年轻王满银，他火烧屁股般赶到家里，再也不愿意离开。</p><p>田福堂，双水村权力最大的人，他控制了村里上上下下，唯独家里两个孩子脱离了他的控制。润叶在政治婚姻的巅峰时如同离婚，在婚姻跌入谷底时又选择回去。润生前半生是个乖乖仔，在重遇寡妇郝红梅时，义无反顾的在一起。田福堂一辈子没做什么大事，唯一一件开山辟岭的大事件，除了去金家的那一跪和炸山那一炮外，再无动静。农村翻天覆地的变化时，他躺在石碾上晒太阳，等到卸去了权力后，他一人带着继孙子和亲孙子，来看热闹。</p><p>田福军，平凡的世界少有的不平凡人。从县里到市里，从市里到省里，虽然偶有政敌和障碍，但也算是步步高升。他没有想到女儿和一个挖煤工人在一起，也没有想到女儿会在洪灾来临时第一时间赶往前线，更没想到深夜会接到女儿的噩耗。在那一刻，田福军也是平凡人，众生皆苦。</p><p>孙少安的事业几经波折，但早已双水村第一农民企业家，但在他接手的乡镇砖瓦厂，事业新巅峰时，秀莲得了肺癌，当然很可能是长期的劳作，加上在砖厂里。</p><p>少平在师父拯救别人意外身亡后承担了师父家里男人的角色，同样在自己拯救别人后，破相了。尽管金秀向他表示了爱意，但自尊心强的他，永远也不会答应。故事的最后，他独自坐车回去铜城，如无意外，将成为下一个王世才。别忘了王世才出场时的介绍，他背驼的厉害，镶着两颗金牙，这是煤矿留给他的纪念，也是颁给他的荣耀勋章。少平领取了勋章后，也是真正的成为煤矿的人，他和慧英嫂再无隔阂。</p><p>路遥是一个出身上世纪黄土地的作家，对于那个时代和黄土地，写起来得心应手，一方面是他本身生活在那个时代那个地方，另一方面他写作时也回到黄土地，查阅了很多资料，咨询了很多人，为此他耗尽了生命的力量。他真实的刻画了双水村，和双水村的人，几十年的历史变迁，几代人的利害纠葛。尤其是农村的那种既能看到些许未来的盼望，又能一眼看到尽头的绝望。</p><p>尽管文笔略显稚嫩，部分人物太脸谱化，官场描述太苍白，但这部书仍不失为一个乡土文学的经典之作。作为一个生于农村长于农村的乡下孩子，即使相隔几十年，仍然能找到许多共鸣。</p><p>我爱农村，我恨农村，有时想回到那里，有时想离开那里。我们都在平凡的世界，众生皆苦。</p><p><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=4026798550,3004258749&amp;fm=26&amp;gp=0.jpg" alt="111"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://timgsa.baidu.com/timg?image&amp;amp;quality=80&amp;amp;size=b9999_10000&amp;amp;sec=1544113284671&amp;amp;di=773633a67536c922954ac5b4bd
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="随笔" scheme="http://amonxu.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>回</title>
    <link href="http://amonxu.com/2018/11/07/2018-11-07-Back/"/>
    <id>http://amonxu.com/2018/11/07/2018-11-07-Back/</id>
    <published>2018-11-07T10:59:00.000Z</published>
    <updated>2019-01-16T07:02:38.174Z</updated>
    
    <content type="html"><![CDATA[<p>像路遥这样通过努力摆脱农村走进城市的作家，在达成愿望之后又自觉不自觉地返回了农村，并打算一辈子写农村。“在农村的时候，总有一种本能要摆脱，等到出去了，又觉得离不开这里，又会回来。这是很多从农村走去出的人共同的心情。”王天笑说。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;像路遥这样通过努力摆脱农村走进城市的作家，在达成愿望之后又自觉不自觉地返回了农村，并打算一辈子写农村。“在农村的时候，总有一种本能要摆脱，等到出去了，又觉得离不开这里，又会回来。这是很多从农村走去出的人共同的心情。”王天笑说。&lt;/p&gt;

      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="故乡" scheme="http://amonxu.com/tags/%E6%95%85%E4%B9%A1/"/>
    
  </entry>
  
  <entry>
    <title>我与A股的股市(一)</title>
    <link href="http://amonxu.com/2018/10/18/2018-10-18-A-shares/"/>
    <id>http://amonxu.com/2018/10/18/2018-10-18-A-shares/</id>
    <published>2018-10-18T03:12:13.000Z</published>
    <updated>2019-01-16T08:18:33.197Z</updated>
    
    <content type="html"><![CDATA[<p>刚炒股时：老子都上雪球了，手握百十万资产，分分钟几千几万上下，看得上你这破100元购物券？<br>炒股后：哪里还有这样的活动？真香！</p><p>说起股票，我算是接触的比较晚的。就连最近的2015年大牛市与大熊市都错过了，5000点是什么？李大霄是谁？那时候的我正值事业的剧烈变动中，一心只想在事业上再攀高峰。</p><p>2017年事业稍显稳定，加上手里有点资产，开始膨胀了。因缘际会之下，我接触了股市，然后开了个户，先实盘买入第一支股票：驰宏锌锗。几天后，我成功亏损了几十元。</p><p>我开始怀疑自己了，我也许不适合做这个，我的资产亏损了几十元，好像亏损了几十万，因为这几十块的差别，导致我差几十元登上福布斯排行榜榜，追悔莫及。</p><p>接下来，在每天的上上下下几元十几元几十元后，我厌烦了这种几块钱的买卖，准备开始加大投入。</p><p>彼时，新能源一片火热。火热的市场环境，清晰可见的未来，加上身边随处可见的比亚迪和绿色的新能源牌照，我感觉可以在此领域开启我的巴菲特投资之路。</p><p>在深入了解新能源行业的上下游情况和相关企业后，以及查看对应龙头的相关信息，我购入了第二支股票：赣锋锂业，价格60多元。</p><p>当时赣锋锂业一路上行，炙手可热。有人觉得到顶了，有人觉得还有上升空间，各种鱼龙混杂的投资者和假先知们大行其道。站在风口上，看着每天大红的持仓和不断翻动的数字，我又膨胀地觉得自己也许就是投资的料。</p><p>赣锋锂业继续向上突破，市场依然各种情绪在波动，在泛滥，而每一天的各种情绪，都是前一天的情绪在复制，在延续。</p><p>都说懂得什么时候买入的是高手，懂得什么时候卖的是大神。而我既不懂得什么时候买，也不懂得什么时候卖。买入担心下一刻就跌，卖出又担心下一刻会涨。犹豫不决之下，买入的一直在手里憋着，且时不时忍不住又贪婪地买了一些。</p><p>站在风口，猪也能飞，看着财富一天天不断的在放大，我终于有一天开始觉得坐立不安了。我咨询了一些业界前辈和专家，问他们怎么看。他们众口纷纭，有的说涨幅已经透支了未来的潜力，接下来会回调，有的说市场长期看好。当他们问我的看好的价位是多少，我随口说：120。</p><p>鬼才信呢！我默默地把心理价位定为100，一定有很多个和我一样这样想的。那么到底是永远都到不了100呢，还是不到100就故意不到100，还是到了100也不停步继续攀登，还是100压根是个无所谓的节点？</p><p>墨菲定律说如果一件事情可能发生，那么它一定会发生。2017年9月11号，赣锋锂业最高价100元整，收盘价100元整，所有人都在盯着100元整这个价位。明天好看了！</p><p>2017年9月12日，赣锋锂业开盘突破100元，交易市场剧烈变动，最高达到103.49元，唱多者和唱空者还没来及相互打脸，然后一路下行，最低90元整，最后收盘92.3元。多军和空军只能互相抚摸肿胀的脸。</p><p>至于我？我的那些憋在手里的怎么处理的？留给大家猜想吧。不过我想说的是，你们每想到的一种操作，这个市场都有人做到了。</p><p>这就是A股，一个普通的小股民的故事，它是你，也是我，更是每一个人。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;刚炒股时：老子都上雪球了，手握百十万资产，分分钟几千几万上下，看得上你这破100元购物券？&lt;br&gt;炒股后：哪里还有这样的活动？真香！&lt;/p&gt;
&lt;p&gt;说起股票，我算是接触的比较晚的。就连最近的2015年大牛市与大熊市都错过了，5000点是什么？李大霄是谁？那时候的我正值事业的
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="Stocks" scheme="http://amonxu.com/tags/Stocks/"/>
    
  </entry>
  
  <entry>
    <title>Charles 抓 HTTPS 包设置</title>
    <link href="http://amonxu.com/2018/09/28/2018-09-28-iOS-Setting/"/>
    <id>http://amonxu.com/2018/09/28/2018-09-28-iOS-Setting/</id>
    <published>2018-09-28T03:12:13.000Z</published>
    <updated>2019-01-16T08:18:11.821Z</updated>
    
    <content type="html"><![CDATA[<p>手机浏览器打开 <a href="http://chls.pro/ssl" target="_blank" rel="noopener">http://chls.pro/ssl</a>，安装相关证书即可。</p><p>部分设备安装证书后还有问题，请看下面：</p><blockquote><p>On iOS 10.3: Settings &gt; General &gt; About (logically…) &gt; Certificate Trust Settings &gt; Enable Full Trust for Root Certificates</p></blockquote><p>参考：</p><p><a href="https://forums.developer.apple.com/message/212408#212408" target="_blank" rel="noopener">https://forums.developer.apple.com/message/212408#212408</a></p><p><a href="https://forums.developer.apple.com/thread/71789" target="_blank" rel="noopener">https://forums.developer.apple.com/thread/71789</a></p><p><a href="https://github.com/bumaociyuan/ios-ipa-server/issues/23#issuecomment-293828854" target="_blank" rel="noopener">https://github.com/bumaociyuan/ios-ipa-server/issues/23#issuecomment-293828854</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;手机浏览器打开 &lt;a href=&quot;http://chls.pro/ssl&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://chls.pro/ssl&lt;/a&gt;，安装相关证书即可。&lt;/p&gt;
&lt;p&gt;部分设备安装证书后还有问题，请看下面：&lt;/p&gt;
&lt;bl
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="Charles" scheme="http://amonxu.com/tags/Charles/"/>
    
  </entry>
  
  <entry>
    <title>四季怨</title>
    <link href="http://amonxu.com/2018/08/29/2018-08-29-Seasons-Regret/"/>
    <id>http://amonxu.com/2018/08/29/2018-08-29-Seasons-Regret/</id>
    <published>2018-08-29T04:06:05.000Z</published>
    <updated>2019-01-16T08:08:40.559Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://wx4.sinaimg.cn/mw690/8cba4200gy1fuqg12kfqmj20yi1pcgp3.jpg" alt="sjy"></p><p><strong>四季怨</strong> <a href="http://music.163.com/#/m/song?id=424477863" target="_blank" rel="noopener">🎵</a>  </p><p> 樱红柳绿春光转，<br> 山碧水墨夏意暖。<br> 云雨秋风携冬来，<br> 犹望美人恨生晚。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://wx4.sinaimg.cn/mw690/8cba4200gy1fuqg12kfqmj20yi1pcgp3.jpg&quot; alt=&quot;sjy&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;四季怨&lt;/strong&gt; &lt;a href=&quot;http://music
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="随笔" scheme="http://amonxu.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>青衫湿</title>
    <link href="http://amonxu.com/2018/08/28/2018-08-28-Qing-Shan-Shi/"/>
    <id>http://amonxu.com/2018/08/28/2018-08-28-Qing-Shan-Shi/</id>
    <published>2018-08-28T08:32:45.000Z</published>
    <updated>2019-01-16T08:08:21.484Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://wx2.sinaimg.cn/mw690/8cba4200gy1fuqg30f69dj20yi1pcgph.jpg" alt="qss"></p><p><strong>青衫湿</strong> <a href="http://music.163.com/#/m/song?id=461656630" target="_blank" rel="noopener">🎵</a>  </p><p> 登高车马深，<br> 倚楼山水昏。<br> 每见尾气起，<br> 犹思炊烟升。<br> 挥汗十余载，<br> 无悔付青春。<br> 愿求她长伴，<br> 青衫易功勋。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://wx2.sinaimg.cn/mw690/8cba4200gy1fuqg30f69dj20yi1pcgph.jpg&quot; alt=&quot;qss&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;青衫湿&lt;/strong&gt; &lt;a href=&quot;http://music
      
    
    </summary>
    
      <category term="鬼画弧" scheme="http://amonxu.com/categories/%E9%AC%BC%E7%94%BB%E5%BC%A7/"/>
    
    
      <category term="随笔" scheme="http://amonxu.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>UITextView 单行模式和 Send 按钮发送</title>
    <link href="http://amonxu.com/2018/07/19/2018-07-19-UITextView/"/>
    <id>http://amonxu.com/2018/07/19/2018-07-19-UITextView/</id>
    <published>2018-07-19T03:12:13.000Z</published>
    <updated>2019-01-16T07:47:27.793Z</updated>
    
    <content type="html"><![CDATA[<p>设置单行模式，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">textView.textContainer.maximumNumberOfLines</span><br></pre></td></tr></table></figure></p><p>设置键盘上的 Send 按钮发送<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)textView:(UITextView *)textView shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)text &#123;</span><br><span class="line"></span><br><span class="line">    if([text isEqualToString:@&quot;\n&quot;]) &#123;</span><br><span class="line">        [textView resignFirstResponder];</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;设置单行模式，&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;
      
    
    </summary>
    
      <category term="Technology" scheme="http://amonxu.com/categories/Technology/"/>
    
    
      <category term="iOS" scheme="http://amonxu.com/tags/iOS/"/>
    
  </entry>
  
</feed>
